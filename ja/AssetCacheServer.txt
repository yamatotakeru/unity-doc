! キャッシュサーバ (チームライセンス専用) / Cache Server (Team license only)

Unity は完全に自動的なアセットパイプラインを持っています。アセット元となるpsdファイルやfbxファイルが変更されたら、Unityは自動的に再インポートします。ファイルからインポートされたデータはすぐに内部フォーマットに変換され保存されます。このアセットパイプラインのいいところは、実用的な逐次の再読み込みする点と、目に見えているアセットのゲーム内の同期が保証されている点です。ただ一方でこの機能にはいくばくかコストがかかります。どのアセットも修正されたら、すぐに必ず再インポートされます。長い間隔が空いてSCMから最新のデータを取得した後になると、他のチームメンバーの修正または作成した全てのアセットを再インポートするために長時間待つことになります。また、他のプラットフォームへ移動する度に、多くのアセットを再インポートすることになります。

このアセットをインポートする時間を、$$Cache Server$$ でインポートされたアセットデータをキャッシュすることで、ドラスティックに縮めることができます。

それぞれのアセットインポートは以下に基づいてキャッシュされます。
* アセットファイルそのもの
* インポート設定
* インポートされたアセットのバージョン
* 現在のプラットフォーム

以上のどれかが変更された場合、アセットは再インポートされるか、キャッシュサーバからダウンロードされます。

PreferenceでCache serverをオンにすると、複数のプロジェクト間のアセットインポートもシェアすることも可能です。

気をつけていただきたいのは、いったんCache Server を設定すると、この過程は全て自動的になり、追加のワークフローはありません。何ら手間を必要とせずに、インポートするための時間を単純に短縮してくれるでしょう。

!! $$Cache Server$$ の設定(利用者側の設定)
キャッシュサーバを設定する方法はかぎりなく簡単です。やることはPreferencesの「Use Cache Server」をオンにすることと、ローカルマシンの $$Unity Editor$$ にどこに $$Cache Server$$ があるのか教えてあげることです。
->Attach:CacheServerEnabled.png

この項目はMacでは ^^Unity->Preferences^^ 、PCでは ^^Edit->Preferences^^ にあります。

もしローカルマシンにキャッシュサーバがホスティングされているなら、サーバーアドレスは ''localhost'' にして下さい。ただ、ローカルPCではハードディスクサイズの制限があるため、キャッシュサーバは他のマシンにインストールすることをおすすめします。

!! $$Cache Server$$ の設定(管理者側の設定)
管理者は キャッシュされたアセットを置いておくための $$Cache Server$$ マシンの設定する必要があります。

以下の通りにしてください:
* キャッシュサーバ [[http://unity3d.com/unity/team/cacheserver/|ここ]] からダウンロードしてください。
* そのファイルを展開すると、下記のようになります:
->Attach:CacheServerZipCropped.png

* OSごとに違いますが、該当のコマンドスクリプトを走らせて下さい。
* 下記のようにバックグラウンドで動いているキャッシュサーバをターミナルウィンドウで確認できます
->Attach:CacheServerTerminal.png

$$Cache Server$$ はとても大きいストレージを持つ信頼できるマシンが必要です（複数のバージョンのインポートされたリソースを保存しておくため、プロジェクト自体のサイズ以上に大きいでしょう）。 もしハードディスクが $$Cache Server$$ でいっぱいになったらパフォーマンスは落ちるかもしれません。

!! サービスとしキャッシュサーバをインストール

Unityが提供している @@.sh@@ や @@.cmd@@ のスクリプトはサーバーでサービスとしてセットした方が良いでしょう。
そうすることで、いつでもキャッシュサーバは安全に中断や再起動ができます。

!!キャッシュサーバ構成

スクリプトをダブルクリックで単にCache Serverを起動すると、スクリプトの同階層に "cache" ディレクトリが作られ、そこにデータが保存されます。キャッシュディレクトリは50GBまで大きくなることが許可されています。このサイズの設定やデータの場所は以下のコマンドラインオプションで変更できます:

@@./RunOSX.command --path ~/mycachePath --size 2000000000@@

@@--path@@ はキャッシュのパスで、 @@--size@@ は最大キャッシュサイズ(byte)です。

!! キャッシュサーバでホスティングするマシンの必要スペック

最高のパフォーマンスを得るために、インポートされたプロジェクト全体が網羅できるだけの十分なメモリ容量が必要です。加えて高速なハードディスクと高速なイーサーネット接続があるのがベストでしょう。ハードディスクは十分に空き容量がある方がより良いでしょう。ただ一方キャッシュサーバはCPUパワーはほとんど必要ではありません。

Cache Serverのバージョンコントロールとの主な違いは、キャッシュ化されたデータはいつもローカルでリビルドされたもの、ということです。これは単純なパフォーマンス改善のためのツールということです。この理由でキャッシュサーバはインターネットでの利用は役に立ちません。分散しているチームならば、それぞれのロケーションでキャッシュサーバを立てるべきでます。

Linux か Mac OS X マシンでキャッシュサーバを走らせるべきでます。キャッシュサーバがデータを保存する際にファイルロックが引き起こされる問題があり、Windowsのファイルシステムはあまり最適化に良くないのです。Linux や Mac OS Xではそのようなことがありません。

[[CacheServerFAQ | キャッシュサーバー FAQ]] も参照して下さい。
