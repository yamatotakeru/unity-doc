! ナビメッシュレイヤー（Unity Proのみ）

ナビゲーションシステムの役割はナビゲーションする空間上で最適な経路を探索することです。もっとも初歩的な例では最短距離となります。しかしより高度なシーンにおいては渡りにくさが異なる経路（マス）が存在することがあります（例えば川を渡ることは橋をわたるよりも移動コストが高い、など）。この状況をモデル化するために、Unityでは「コスト」という概念を活用し「最適経路」はもっとも低コストの経路と定義しています。コストの異なる空間を管理するためにUnityはナビメッシュレイヤという概念を持っています。ナビメッシュスタティック（Navmesh Static）としてマークされたオブジェクトはナビメッシュレイヤに属することになります。

経路探索の際、経路の長さを比較するのではなくコストの高さで評価を行います。この計算を行うために経路をセグメントに分け、各セグメントのナビメッシュレイヤのコストを経路の長さに乗じます。すべてのコストが1にセットされると、最適経路が最短経路と等価であることに注意してください。

プロジェクトごとのカスタムレイヤーを定義するには
*メニューの「Edit」→「Project Settings」→「Navmesh Layers」を選択します
->Attach:NavMeshLayers.png

*ユーザレイヤーのどれかへ移動し名前（Name）とコスト（Cost）をセットアップします
**名前（Name）でシーン上のナビメッシュレイヤを一意に識別します。

**コスト（Cost）でナビメッシュレイヤを移動する難易度を示します。デフォルト値は1、倍の難易度は2、半分の難易度は0.5などと設定します。
*3種類のビルトインのレイヤがあります
**Default　指定がなかった場合のデフォルトのコスト
**Not Walkable　移動できないため空間のためコスト無視
**Jump　自動生成されたオフメッシュリンク（Off-mesh link）のコスト

カスタムのレイヤーを特定の物体に適用するには
*エディタ上で物体を選択します
*ナビゲーションメッシュウィンドウを開きます（メニューの「Window」→「Navigation」を選択します）
*オブジェクト（Object）タブに移動し、適用したいナビゲーションレイヤを選択します
->Attach:NavigationMeshObjectWindow.png

Navmesh DisplayウィンドウにてShow NavMeshをオンにした場合、エディタ上で各々のレイヤは異なる色で表示されます

エージェントが移動できるレイヤーを識別するためには：
*エージェントの物体にアタッチされているナビメッシュエージェントコンポーネントを開きます
*NavMesh Walkable属性を変更します
*スクリプトからエージェントの終点（destination）を必ず設定します


注意：コストを1以下の値は推奨しません。この場合、経路探索により最適経路がみつかることが保証されません


ナビメッシュレイヤーを活用した一つの分かりやすい使用例は、次のとおりです。
*歩行者（エージェント）が渡らないといけない道路があります
*道路の真ん中にある歩道が歩行者にとってもっと望ましい経路です
*道路用のナビメッシュレイヤをセットアップし、コストは高い値、同様に歩道用のナビメッシュレイヤをセットアップし、コストは低い値とします
*これによりエージェントは歩道を好んで移動するようになります
高度な経路探索に関連したトピックとしては、オフメッシュリンク（Off-mesh link）を参照して下さい。

([[NavmeshandPathfinding| ナビゲーションと経路探索]]  に戻る)
